<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Récapitulatif</title>
    <link rel="stylesheet" href="../CSS/styleEndForm.css">
</head>

<body>
    <header>
        <h1>Récapitulatif de vos informations</h1>
    </header>

    <main>
        <p><strong>Civilité :</strong> <span id="civilite"></span></p>
        <p><strong>Nom :</strong> <span id="nom"></span></p>
        <p><strong>Prénom :</strong> <span id="prenom"></span></p>
        <p><strong>Adresse :</strong> <span id="adresse"></span></p>
        <p><strong>Date de naissance :</strong> <span id="date_naissance"></span></p>
        <p><strong>Email :</strong> <span id="email"></span></p>
        <p><strong>Sport pratiqué :</strong> <span id="sport"></span></p>
        <p><strong>Lieu sélectionné :</strong> <span id="lieu"></span></p>
        <p><strong>Météo :</strong></p>
        <ul>
            <li><strong>Température maximale :</strong> <span id="temperature_max"></span></li>
            <li><strong>Température minimale :</strong> <span id="temperature_min"></span></li>
        </ul>

        <a href="Contact.html">Retourner au formulaire</a>
    </main>

    <script>
        // Récupération des données du formulaire
        const params = new URLSearchParams(window.location.search);

        // Affichage des données dans le HTML
        document.getElementById('civilite').textContent = params.get('civilite');
        document.getElementById('nom').textContent = params.get('nom');
        document.getElementById('prenom').textContent = params.get('prenom');
        document.getElementById('adresse').textContent = params.get('adresse');
        document.getElementById('date_naissance').textContent = params.get('date_naissance');
        document.getElementById('email').textContent = params.get('email');
        document.getElementById('sport').textContent = params.get('sport');
        const lieu = params.get('lieu');
        document.getElementById('lieu').textContent = lieu;

        // Clé API OpenCage
        const openCageApiKey = "485ac785a5b04dd2bc2d583034375cd6";

        // Récupérer les coordonnées avec OpenCage
        fetch(`https://api.opencagedata.com/geocode/v1/json?q=${lieu}&key=${openCageApiKey}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erreur lors de la récupération des coordonnées");
                }
                return response.json();
            })
            .then(data => {
                const location = data.results[0]?.geometry;
                if (!location) {
                    throw new Error("Coordonnées introuvables");
                }
                const { lat, lng } = location;

                // Construire l'URL de l'API Meteoblue
                const meteoblueApiKey = "0Da6AQbMFG42vqW3"; // Remplace par ta clé valide
                const url = `https://my.meteoblue.com/packages/basic-day?apikey=${meteoblueApiKey}&lat=${lat}&lon=${lng}&asl=0&format=json`;

                // Appeler l'API Meteoblue
                return fetch(url);
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Erreur API Meteoblue");
                }
                return response.json();
            })
            .then(data => {
                // Récupérer les données météo
                const temperatureMax = data.daily?.temperature_max?.[0] || "Non disponible";
                const temperatureMin = data.daily?.temperature_min?.[0] || "Non disponible";

                // Mettre à jour les champs
                document.getElementById('temperature_max').textContent = `${temperatureMax}°C`;
                document.getElementById('temperature_min').textContent = `${temperatureMin}°C`;
            })
            .catch(error => {
                console.error("Erreur :", error);
                document.getElementById('temperature_max').textContent = "Impossible de récupérer les données.";
                document.getElementById('temperature_min').textContent = "Impossible de récupérer les données.";
            });
    </script>
</body>

</html>