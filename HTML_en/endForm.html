<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Récapitulatif</title>
    <link rel="stylesheet" href="../CSS/styleEndForm.css">
</head>

<body>
    <header>
        <h1>Récapitulatif de vos informations</h1>
    </header>

    <main>
        <p><strong>Civilité :</strong> <span id="civilite"></span></p>
        <p><strong>Nom :</strong> <span id="nom"></span></p>
        <p><strong>Prénom :</strong> <span id="prenom"></span></p>
        <p><strong>Adresse :</strong> <span id="adresse"></span></p>
        <p><strong>Date de naissance :</strong> <span id="date_naissance"></span></p>
        <p><strong>Email :</strong> <span id="email"></span></p>
        <p><strong>Sport pratiqué :</strong> <span id="sport"></span></p>
        <p><strong>Lieu sélectionné :</strong> <span id="lieu"></span></p>
        <p><strong>Météo :</strong></p>
        <ul>
            <li><strong>Température maximale :</strong> <span id="temperature_max"></span></li>
            <li><strong>Température minimale :</strong> <span id="temperature_min"></span></li>
            <li><strong>État du ciel :</strong> <span id="etat_ciel"></span></li>
        </ul>

        <a href="Contact.html">Retourner au formulaire</a>
    </main>

    <script>
        // Liste des coordonnées pour chaque lieu
        const locations = {
            Nice: { lat: 43.7034, lon: 7.2663 },
            Marseille: { lat: 43.2965, lon: 5.3698 },
            Montpellier: { lat: 43.6108, lon: 3.8767 },
            Bordeaux: { lat: 44.8378, lon: -0.5792 },
            Nantes: { lat: 47.2184, lon: -1.5536 },
            Brest: { lat: 48.3904, lon: -4.4861 },
            Lille: { lat: 50.6292, lon: 3.0573 }
        };

        // Récupération des données du formulaire
        const params = new URLSearchParams(window.location.search);

        // Affichage des données dans le HTML
        document.getElementById('civilite').textContent = params.get('civilite');
        document.getElementById('nom').textContent = params.get('nom');
        document.getElementById('prenom').textContent = params.get('prenom');
        document.getElementById('adresse').textContent = params.get('adresse');
        document.getElementById('date_naissance').textContent = params.get('date_naissance');
        document.getElementById('email').textContent = params.get('email');
        document.getElementById('sport').textContent = params.get('sport');
        const lieu = params.get('lieu');
        document.getElementById('lieu').textContent = lieu;

        // Vérifier si le lieu est valide
        if (locations[lieu]) {
            const { lat, lon } = locations[lieu];

            // Construire l'URL de l'API Meteoblue
            const apiKey = "0Da6AQbMFG42vqW3"; // Votre clé API
            const url = `https://my.meteoblue.com/packages/basic-day?apikey=${apiKey}&lat=${lat}&lon=${lon}&asl=0&format=json`;

            // Appeler l'API
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error("Erreur API");
                    }
                    return response.json();
                })
                .then(data => {
                    // Récupérer les données météo
                    const temperatureMax = data.daily.temperature_max[0];
                    const temperatureMin = data.daily.temperature_min[0];
                    const cloudCover = data.daily.cloud_cover[0];

                    // Mettre à jour les champs
                    document.getElementById('temperature_max').textContent = `${temperatureMax}°C`;
                    document.getElementById('temperature_min').textContent = `${temperatureMin}°C`;
                    document.getElementById('etat_ciel').textContent =
                        cloudCover < 20
                            ? "Ensoleillé"
                            : cloudCover < 50
                                ? "Partiellement nuageux"
                                : "Très nuageux";
                })
                .catch(error => {
                    console.error("Erreur API :", error);
                    document.getElementById('temperature_max').textContent = "Impossible de récupérer les données.";
                    document.getElementById('temperature_min').textContent = "Impossible de récupérer les données.";
                    document.getElementById('etat_ciel').textContent = "Impossible de récupérer les données.";
                });
        } else {
            document.getElementById('temperature_max').textContent = "Lieu non pris en charge.";
            document.getElementById('temperature_min').textContent = "Lieu non pris en charge.";
            document.getElementById('etat_ciel').textContent = "Lieu non pris en charge.";
        }
    </script>
</body>

</html>